---
import Layout from '../layouts/Layout.astro';
import { socials } from '../config/socials';
import SocialIcons from '../components/SocialIcons.astro';
import { Picture } from 'astro:assets';
import avatar from '../images/avatar.jpg';
---

<Layout title="Soumyo Dey">
  <main class="space-y-16">
    <section class="relative isolate overflow-hidden rounded-[32px] border border-[var(--color-border-light)] bg-[var(--color-surface-light)] px-4 py-16 text-center shadow-soft dark:border-[var(--color-border-dark)] dark:bg-[rgba(19,26,42,0.92)] sm:px-6">
      <div class="pointer-events-none absolute inset-x-0 -top-32 h-[420px] bg-[radial-gradient(circle_at_top,rgba(76,95,215,0.35),transparent_65%)] dark:bg-[radial-gradient(circle_at_top,rgba(142,162,255,0.35),transparent_60%)]" aria-hidden="true"></div>
      <div class="relative mx-auto flex max-w-3xl flex-col items-center gap-10">
        <p class="inline-flex items-center gap-3 rounded-full border border-[var(--color-border-light)]/80 px-4 py-2 text-xs font-semibold uppercase tracking-[0.4em] text-[var(--color-muted-light)] dark:border-[var(--color-border-dark)] dark:text-[var(--color-muted-dark)]">
          Tech • Data & AI Products • Stories
        </p>
        <div class="relative">
          <div class="gradient-ring absolute inset-0 rounded-full opacity-70 blur-[60px]"></div>
          <div class="relative mx-auto h-32 w-32 rounded-full border-4 border-[var(--color-surface-light)] shadow-card dark:border-[rgba(19,26,42,0.92)]">
            <Picture
              src={avatar}
              widths={[128, 256]}
              sizes="128px"
              formats={['avif', 'webp', 'jpeg']}
              alt="Profile"
              loading="eager"
              fetchpriority="high"
              class="h-full w-full rounded-full object-cover"
            />
          </div>
        </div>
        <div class="space-y-5">
          <h1 class="text-4xl font-serif font-semibold tracking-tight text-[var(--color-text-light)] dark:text-[var(--color-text-dark)] sm:text-5xl">
            Soumyo Dey
          </h1>
          <p class="text-lg text-[var(--color-muted-light)] dark:text-[var(--color-muted-dark)]">
            Tech, AI & data products, and the stories picked up along the way
          </p>
        </div>
        <div class="flex flex-col items-center gap-3">
          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-[var(--color-muted-light)] dark:text-[var(--color-muted-dark)]">Connect</p>
          <div class="flex flex-wrap justify-center gap-4">
            {socials.map((social) => <SocialIcons {...social} />)}
          </div>
        </div>
        <div class="flex w-full flex-col gap-4 sm:flex-row sm:justify-center">
          <a
            href="/blog"
            class="inline-flex items-center justify-center rounded-full bg-[var(--color-primary-light)] px-6 py-3 text-base font-semibold text-white shadow-lg shadow-[rgba(76,95,215,0.35)] transition-transform hover:-translate-y-0.5 hover:bg-[var(--color-primary-light-hover)] dark:bg-[var(--color-primary-dark)] dark:text-[var(--color-text-dark)] dark:hover:bg-[var(--color-primary-dark-hover)]"
          >
            Explore writing
          </a>
          <a
            href="#newsletter-section"
            class="inline-flex items-center justify-center rounded-full border border-[var(--color-border-light)] bg-white/70 px-6 py-3 text-base font-semibold text-[var(--color-text-light)] transition-colors hover:border-transparent hover:bg-[var(--color-primary-light)]/10 hover:text-[var(--color-primary-light)] dark:border-[var(--color-border-dark)] dark:bg-[rgba(19,26,42,0.7)] dark:text-[var(--color-text-dark)] dark:hover:bg-[var(--color-primary-dark)]/15 dark:hover:text-[var(--color-primary-dark)]"
          >
            Come along for the ride
          </a>
        </div>
      </div>
    </section>

    <!-- Newsletter section with optimized loading -->
    <section
      id="newsletter-section"
      class="grid gap-6 rounded-[28px] border border-[var(--color-border-light)] bg-[var(--color-surface-light)] p-8 shadow-card dark:border-[var(--color-border-dark)] dark:bg-[rgba(19,26,42,0.92)] lg:grid-cols-[1.2fr_0.8fr] lg:gap-10"
    >
      <!-- Static content shown immediately -->
      <div class="space-y-6">
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-[var(--color-muted-light)] dark:text-[var(--color-muted-dark)]">Newsletter</p>
        <div class="space-y-4">
          <h2 class="text-3xl font-serif font-semibold text-[var(--color-text-light)] dark:text-[var(--color-text-dark)]">Stochastic Musings</h2>
          <p class="text-[var(--color-muted-light)] dark:text-[var(--color-muted-dark)]">
            Short dispatches on building lovable products, decoding AI signals, and savoring stories from noodles to night trains.
          </p>
          <ul class="space-y-2 text-left text-sm text-[var(--color-muted-light)] dark:text-[var(--color-muted-dark)]">
            <li>• Evergreen essays and field notes</li>
            <li>• Occasional deep dives into product strategy</li>
            <li>• Travel sketches and experiments worth sharing</li>
          </ul>
        </div>
        <button
          id="load-newsletter"
          class="inline-flex w-full items-center justify-center rounded-full bg-[var(--color-primary-light)] px-6 py-3 text-base font-semibold text-white shadow-lg shadow-[rgba(76,95,215,0.35)] transition-transform hover:-translate-y-0.5 hover:bg-[var(--color-primary-light-hover)] dark:bg-[var(--color-primary-dark)] dark:text-[var(--color-text-dark)] dark:hover:bg-[var(--color-primary-dark-hover)]"
          onclick="loadNewsletterEmbed()"
        >
          Subscribe here
        </button>
      </div>

      <!-- Container for lazy-loaded iframe -->
      <div id="substack-container" class="hidden">
        <div class="flex h-full min-h-[260px] w-full items-center justify-center rounded-2xl border border-dashed border-[var(--color-border-light)] text-[var(--color-muted-light)] dark:border-[var(--color-border-dark)] dark:text-[var(--color-muted-dark)]">
          Loading newsletter...
        </div>
      </div>
    </section>
    <script is:inline>
      function setupNewsletter() {
        function loadNewsletterEmbed() {
          const container = document.getElementById('substack-container');
          const button = document.getElementById('load-newsletter');

          if (container && button) {
            // Show container
            container.classList.remove('hidden');

            // Create and append iframe
            const iframe = document.createElement('iframe');
            iframe.src = 'https://stochasticmusings.substack.com/embed';
            iframe.style.width = '100%';
            iframe.style.height = '320px';
            iframe.style.border = 'none';
            iframe.classList.add('rounded-lg', 'dark:filter', 'dark:invert');

            // Replace loading message with iframe
            container.innerHTML = '';
            container.appendChild(iframe);

            // Hide button
            button.classList.add('hidden');
          }
        }
        
        // Expose to global scope for onclick handler
        window.loadNewsletterEmbed = loadNewsletterEmbed;

        // Load newsletter automatically if user has previously interacted
        if (localStorage.getItem('newsletter-interaction')) {
          setTimeout(loadNewsletterEmbed, 1000);
        }

        // Save interaction preference
        document.getElementById('load-newsletter')?.addEventListener('click', () => {
          localStorage.setItem('newsletter-interaction', 'true');
        });
      }
      
      // Initial load
      setupNewsletter();
      
      // View Transitions load
      document.addEventListener('astro:page-load', setupNewsletter);
    </script>
  </main>
</Layout>

<style>
  iframe {
    min-width: 480px;
    max-width: 100%;
    width: 100%;
    height: 320px;
    background: transparent;
  }

  @media (max-width: 480px) {
    iframe {
      min-width: 100%;
    }
  }
</style>
